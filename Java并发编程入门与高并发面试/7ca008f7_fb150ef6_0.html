<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<style>
			table{border-collapse: collapse; border: 1px solid gray; border-width: 2px 1px 2px 1px;}
			th{border: 1px solid gray; padding: 4px; background-color: #ddd;}
			td{border: 1px solid gray; padding: 4px;}
			tr:nth-child(2n){background-color: #f8f8f8;}
			pre{border: 2px solid #d6d6d6; padding: 0px; border-radius: 3px;}
		</style>
	</head>
	<body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">
		<div><img src="data:image/png;base64,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" />
		</div>
		<div><br />
		</div>
		<div>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<pre style="background-color:#ffffff;color:#000000;font-family:'Consolas';font-size:13.5pt;">
<span style="color:#000080;font-weight:bold;">package </span>com.mmall.concurrency.example.lock;<br><br><span style="color:#000080;font-weight:bold;">import </span>java.util.concurrent.locks.StampedLock;<br><br><span style="color:#000080;font-weight:bold;">public class </span>LockExample4 {<br><br>    <span style="color:#000080;font-weight:bold;">class </span>Point {<br>        <span style="color:#000080;font-weight:bold;">private double </span><span style="color:#660e7a;font-weight:bold;">x</span>, <span style="color:#660e7a;font-weight:bold;">y</span>;<br>        <span style="color:#000080;font-weight:bold;">private final </span>StampedLock <span style="color:#660e7a;font-weight:bold;">sl </span>= <span style="color:#000080;font-weight:bold;">new </span>StampedLock();<br><br>        <span style="color:#000080;font-weight:bold;">void </span>move(<span style="color:#000080;font-weight:bold;">double </span>deltaX, <span style="color:#000080;font-weight:bold;">double </span>deltaY) { <span style="color:#008000;font-weight:bold;">// an exclusively locked method<br></span><span style="color:#008000;font-weight:bold;">            </span><span style="color:#000080;font-weight:bold;">long </span>stamp = <span style="color:#660e7a;font-weight:bold;">sl</span>.writeLock();<br>            <span style="color:#000080;font-weight:bold;">try </span>{<br>                <span style="color:#660e7a;font-weight:bold;">x </span>+= deltaX;<br>                <span style="color:#660e7a;font-weight:bold;">y </span>+= deltaY;<br>            } <span style="color:#000080;font-weight:bold;">finally </span>{<br>                <span style="color:#660e7a;font-weight:bold;">sl</span>.unlockWrite(stamp);<br>            }<br>        }<br><br>        <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">下面看看乐观读锁案例<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">        </span><span style="color:#000080;font-weight:bold;">double </span>distanceFromOrigin() { <span style="color:#008000;font-weight:bold;">// A read-only method<br></span><span style="color:#008000;font-weight:bold;">            </span><span style="color:#000080;font-weight:bold;">long </span>stamp = <span style="color:#660e7a;font-weight:bold;">sl</span>.tryOptimisticRead(); <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">获得一个乐观读锁<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">            </span><span style="color:#000080;font-weight:bold;">double </span>currentX = <span style="color:#660e7a;font-weight:bold;">x</span>, currentY = <span style="color:#660e7a;font-weight:bold;">y</span>;  <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">将两个字段读入本地局部变量<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">            </span><span style="color:#000080;font-weight:bold;">if </span>(!<span style="color:#660e7a;font-weight:bold;">sl</span>.validate(stamp)) { <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">检查发出乐观读锁后同时是否有其他写锁发生？<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">                </span>stamp = <span style="color:#660e7a;font-weight:bold;">sl</span>.readLock();  <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">如果没有，我们再次获得一个读悲观锁<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">                </span><span style="color:#000080;font-weight:bold;">try </span>{<br>                    currentX = <span style="color:#660e7a;font-weight:bold;">x</span>; <span style="color:#008000;font-weight:bold;">// </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">将两个字段读入本地局部变量<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">                    </span>currentY = <span style="color:#660e7a;font-weight:bold;">y</span>; <span style="color:#008000;font-weight:bold;">// </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">将两个字段读入本地局部变量<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">                </span>} <span style="color:#000080;font-weight:bold;">finally </span>{<br>                    <span style="color:#660e7a;font-weight:bold;">sl</span>.unlockRead(stamp);<br>                }<br>            }<br>            <span style="color:#000080;font-weight:bold;">return </span>Math.<span style="font-style:italic;">sqrt</span>(currentX * currentX + currentY * currentY);<br>        }<br><br>        <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">下面是悲观读锁案例<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">        </span><span style="color:#000080;font-weight:bold;">void </span>moveIfAtOrigin(<span style="color:#000080;font-weight:bold;">double </span>newX, <span style="color:#000080;font-weight:bold;">double </span>newY) { <span style="color:#008000;font-weight:bold;">// upgrade<br></span><span style="color:#008000;font-weight:bold;">            // Could instead start with optimistic, not read mode<br></span><span style="color:#008000;font-weight:bold;">            </span><span style="color:#000080;font-weight:bold;">long </span>stamp = <span style="color:#660e7a;font-weight:bold;">sl</span>.readLock();<br>            <span style="color:#000080;font-weight:bold;">try </span>{<br>                <span style="color:#000080;font-weight:bold;">while </span>(<span style="color:#660e7a;font-weight:bold;">x </span>== <span style="color:#0000ff;">0.0 </span>&amp;&amp; <span style="color:#660e7a;font-weight:bold;">y </span>== <span style="color:#0000ff;">0.0</span>) { <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">循环，检查当前状态是否符合<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">                    </span><span style="color:#000080;font-weight:bold;">long </span>ws = <span style="color:#660e7a;font-weight:bold;">sl</span>.tryConvertToWriteLock(stamp); <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">将读锁转为写锁<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">                    </span><span style="color:#000080;font-weight:bold;">if </span>(ws != <span style="color:#0000ff;">0L</span>) { <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">这是确认转为写锁是否成功<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">                        </span>stamp = ws; <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">如果成功 替换票据<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">                        </span><span style="color:#660e7a;font-weight:bold;">x </span>= newX; <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">进行状态改变<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">                        </span><span style="color:#660e7a;font-weight:bold;">y </span>= newY;  <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">进行状态改变<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">                        </span><span style="color:#000080;font-weight:bold;">break</span>;<br>                    } <span style="color:#000080;font-weight:bold;">else </span>{ <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">如果不能成功转换为写锁<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">                        </span><span style="color:#660e7a;font-weight:bold;">sl</span>.unlockRead(stamp);  <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">我们显式释放读锁<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">                        </span>stamp = <span style="color:#660e7a;font-weight:bold;">sl</span>.writeLock();  <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">显式直接进行写锁 然后再通过循环再试<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">                    </span>}<br>                }<br>            } <span style="color:#000080;font-weight:bold;">finally </span>{<br>                <span style="color:#660e7a;font-weight:bold;">sl</span>.unlock(stamp); <span style="color:#008000;font-weight:bold;">//</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">释放读锁或写锁<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">            </span>}<br>        }<br>    }<br>}<br></pre>
		</div>
		<div><img src="data:image/png;base64,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" />
		</div>
		<div>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<pre style="background-color:#ffffff;color:#000000;font-family:'Consolas';font-size:13.5pt;">
<span style="color:#000080;font-weight:bold;">package </span>com.mmall.concurrency.example.lock;<br><br><span style="color:#000080;font-weight:bold;">import </span>com.mmall.concurrency.annoations.<span style="color:#808000;">ThreadSafe</span>;<br><span style="color:#000080;font-weight:bold;">import </span>lombok.extern.slf4j.<span style="color:#808000;">Slf4j</span>;<br><br><span style="color:#000080;font-weight:bold;">import </span>java.util.concurrent.CountDownLatch;<br><span style="color:#000080;font-weight:bold;">import </span>java.util.concurrent.ExecutorService;<br><span style="color:#000080;font-weight:bold;">import </span>java.util.concurrent.Executors;<br><span style="color:#000080;font-weight:bold;">import </span>java.util.concurrent.Semaphore;<br><span style="color:#000080;font-weight:bold;">import </span>java.util.concurrent.locks.StampedLock;<br><br><span style="color:#808000;">@Slf4j<br></span><span style="color:#808000;">@ThreadSafe<br></span><span style="color:#000080;font-weight:bold;">public class </span>LockExample5 {<br><br>    <span style="color:#008000;font-weight:bold;">// </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">请求总数<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">    </span><span style="color:#000080;font-weight:bold;">public static int </span><span style="color:#660e7a;font-style:italic;">clientTotal </span>= <span style="color:#0000ff;">5000</span>;<br><br>    <span style="color:#008000;font-weight:bold;">// </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">同时并发执行的线程数<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">    </span><span style="color:#000080;font-weight:bold;">public static int </span><span style="color:#660e7a;font-style:italic;">threadTotal </span>= <span style="color:#0000ff;">200</span>;<br><br>    <span style="color:#000080;font-weight:bold;">public static int </span><span style="color:#660e7a;font-style:italic;">count </span>= <span style="color:#0000ff;">0</span>;<br><br>    <span style="color:#000080;font-weight:bold;">private final static </span>StampedLock <span style="color:#660e7a;font-weight:bold;font-style:italic;">lock </span>= <span style="color:#000080;font-weight:bold;">new </span>StampedLock();<br><br>    <span style="color:#000080;font-weight:bold;">public static void </span>main(String[] args) <span style="color:#000080;font-weight:bold;">throws </span>Exception {<br>        ExecutorService executorService = Executors.<span style="font-style:italic;">newCachedThreadPool</span>();<br>        <span style="color:#000080;font-weight:bold;">final </span>Semaphore semaphore = <span style="color:#000080;font-weight:bold;">new </span>Semaphore(<span style="color:#660e7a;font-style:italic;">threadTotal</span>);<br>        <span style="color:#000080;font-weight:bold;">final </span>CountDownLatch countDownLatch = <span style="color:#000080;font-weight:bold;">new </span>CountDownLatch(<span style="color:#660e7a;font-style:italic;">clientTotal</span>);<br>        <span style="color:#000080;font-weight:bold;">for </span>(<span style="color:#000080;font-weight:bold;">int </span>i = <span style="color:#0000ff;">0</span>; i &lt; <span style="color:#660e7a;font-style:italic;">clientTotal </span>; i++) {<br>            executorService.execute(() -&gt; {<br>                <span style="color:#000080;font-weight:bold;">try </span>{<br>                    <span style="color:#660e7a;">semaphore</span>.acquire();<br>                    <span style="font-style:italic;">add</span>();<br>                    <span style="color:#660e7a;">semaphore</span>.release();<br>                } <span style="color:#000080;font-weight:bold;">catch </span>(Exception e) {<br>                    <span style="color:#660e7a;font-weight:bold;font-style:italic;">log</span>.error(<span style="color:#008000;font-weight:bold;">"exception"</span>, e);<br>                }<br>                <span style="color:#660e7a;">countDownLatch</span>.countDown();<br>            });<br>        }<br>        countDownLatch.await();<br>        executorService.shutdown();<br>        <span style="color:#660e7a;font-weight:bold;font-style:italic;">log</span>.info(<span style="color:#008000;font-weight:bold;">"count:{}"</span>, <span style="color:#660e7a;font-style:italic;">count</span>);<br>    }<br><br>    <span style="color:#000080;font-weight:bold;">private static void </span>add() {<br>        <span style="color:#000080;font-weight:bold;">long </span>stamp = <span style="color:#660e7a;font-weight:bold;font-style:italic;">lock</span>.writeLock();<br>        <span style="color:#000080;font-weight:bold;">try </span>{<br>            <span style="color:#660e7a;font-style:italic;">count</span>++;<br>        } <span style="color:#000080;font-weight:bold;">finally </span>{<br>            <span style="color:#660e7a;font-weight:bold;font-style:italic;">lock</span>.unlock(stamp);<br>        }<br>    }<br>}<br></pre>
		</div>
		<div><br />
		</div>
		<div>
			<div>09:32:36.333 [main] INFO com.mmall.concurrency.example.lock.LockExample5 - count:5000
			</div>
			<div><br />
			</div>
		</div>
		<div><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAT4AAACYCAIAAADyaBIgAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAPC0lEQVR4nO3dfWwb5R0H8J9zSUihTWFdpVbQdmrqxmMpa0VFY9KBhgQ0sdtmzJUQEvRlM/WQttVxQKAWIdZUW9c4zjaJpfME2fhrAqSW5uqMSUywZmklUGHNyjlOJmh5UcVKu1AINL14f5x9OZ/v7Md5sZ/zfT/iD/t699w9d/n53r84ZFkmALCailIvAABMR+VsNXTktTe0X1cuv/k216rZahwAdOZqr/ufcx+9PSTNUeOllaSYX9j428TUByg+xpU/3W2UCDcJj/VPc9mKY9b2utnOf3zh/McXsoe33nf33M0UwCZwrgtgSRmlK4piV1eXboyuri5RFAtqtHbB/NoF8xlHjkeahJTAX1PDEmF1WObAx2Ixv2a4GEh9yTq2YRmZqcHJROROwWwus9GjfvWfMo7rdI0kKebXLIAcC6Tb0fYi0J/5VZ3QoOMM81Vaqw70a/+1amP3iKaz2e3HI026PiotGK3J/Jsg1fFYdi9yLYMJw61gtsm0q1q4q5u786KM0o3H48PDw9rq7erqGh4ejsfj7C266lbc4779HvftrroVeUcWA8Kt7WuOy7IsyxNSvRQjokS4yfXUGlGWZVmWz3aeadGszcPeoz5ZlmXp143RFkEQW5VxGg979GucceS84/SLjj/LsizLV/v8hnOZaY88O6t6ZVmWX/UPhnamqsKokVzSvejZlPn1fkp0NXnjYUmW5Qmp8x3PVJWyzDcec+7Z55ejR5SlTVKss/2kf98ezeVHg/brgwOv+qObA/1EFI/seNIRPtuzKceaLGQzKdPqzl1N+5jJdCvkWNuTicj3vNHdovzmHmeebVB8cqZDhw75/f5Dhw7pPuf1Sux15b8Ln15Uhlz49KI6UPufOsmE1LmB3BEpo52rfX4i//H012ty3y6i3aKyaZUPqU1b4Q7HTdthGbmgBqcGXpP7dmV+mEmPmsKSZlr/cZNGNFPp2sxoRPc1c9bqPxUwX+1autrnV1dRzvZTnx8NhzdoOm60lvJvAl3H1UnUlW++DOp6yx5tqtlcve7r20UZrXFFf67b1ta2evXq4eHhYDA4PDy8evXqtra2gn4L/nvpsu6DmeRI/BQ11Gf+nI1IZyrcrrr0VwetcjXSkGTwQ+poKODuE8vIRuNMHWJVudpP5WthGj1qcOl/zg0byU3XiPp1RDpDFG1J9cD1xEnTSczn6/T6Gv94pJ+I+o9G3T6PdhWZt+8M9na+GwqtFXvuTw1hWpOM21T795Cjj1pmWyHH2j7s9fa6w89zuL8lIsPLVEr1jo+PT6NuiUga/eD1wbdfH3xbGv0g95iOVfUbaCieWZWrXGsmB6XR9NckjUgnDf7OikOOhZ846U8fSnVuyDf+rPTIsJHpWeVao9tP5jjwM5uv0+tbH+34Taz7QNS/N3Ny8/YTkR3t3w2H30kf9Ba6Js1krz3GPppthRxre7co/SoZujXA6T0i4yvMbW1tmzdvnkbdKsY+vzL2+ZX883Z6f9g4daI1mYj8JkYVzVt3UepMiYiGIx297nDbJqb5KhdC5uh2XCxsuq9Q5zsrPTJsRNlLKHs/okR3R5RlmSuat+4YDO1KX2IRA7nO1Q3nS0QVzuBe/2CbN/SWv/V+XX9N2hcDrqfWiL/fs2evf6rjqhxr0ky0I7VUw5GO58m/VbP2DJch+y/BbCuY9ZqIiJxtA33bo55qLqvX9OaQx+OZ+7k7QwPykYZQvSAIgnDdToenmRzU/Ae5b3vUoxwANbyy7b0Te0r1WJbQHFKunQiC0OcKM+wrZqVHBo0oh6DrU43sFLb5WZbfQc2Hpc5rIZcya7FVPXxlny8R0aatfiJ3Z0j/e2PYvhgQtkT9x3o2EVFLT+pPv/A1meHHPnpEEARBuZ6U0QvGPppvBdNeq42vj3p019V54JDx+gHkE480leo3NEmxRwVvlSg/x3bkZR9z+DQVlIfUPSFxAI+kcwVPU0EuYkCoFLzxsISdHm9wwAxgSdjrAlgSShfAklC6AJaE0gWwJJQugCVZoHT3nwicGxvNPx6AnfB1c+jDLyZOX/xqdOyqOqSutvrY0ANE5HU+vMX5SOkWDYAvHJXuG598efriePbws+ceVD4sq63bftvjy2vrsscBsBteDphf++iKYd1qnR8b7TrVrn4VA8LMXukwTP3TZqDkDUyZTWzZhYlwk8Dho/BQfFyU7odfTJy99HXe0ZbOX9m2obMIy6MNRuDnAUAxkOtVcrAbLl4/OH3xK/Xzta/G33rphc/eHyGiypp59z1+QBm+eKFv/bKHltcuKM0icsDTI8s9JMcCNQdKvSjAAS72utrrUm+99ML4/y59/6dPtzzdpdRtTfWKlUsOLl7o045mbvZT/ziOOAT74qJ0tT57f2TVXffOu/EmdcjKJQdrqvOHSxLRbKX+DaTf21Zqj9eIQ7A17kp3JpQApGOpSFNaHdy3i6JH+2kyETkQdUekVH5ChTP4czUJIRnb7WqvzHypTXOum5rE0yP98oznJ93dO9vX9KXfOG/Zk/qgyzfancpSc3p9jRXpLBun12c0jhLEoQlNSvdCSYFS4ldeFlG7oMdd6X7jW6tG3vzb+OVL05h2LlP/uIs4BJvjonTraqvVz+u37Zy38Ka//27/8f1trx3aazaaoblM/eMu4hBsjovSXbeoRv1cWTOv8eHHWp7uUi9TGY5maO5S/0oecQigw0Xp3nJD1bpF83KPs27RvFtuqNINlNMBf4IgVG3sHp1x6p9SLprLVMJd3QlOIg6VK9XV3ujkoNIRlLStWeBBSCJat2je3UuvL/LyzBFEHMKs4OKRDMXdS6+vq63Kfv1g3aKa7P0tgM1xVLpEdMsNVahSABYcHTADADsuLlMBQKFQugCWhNIFsCSULoAloXQBLMkCpYtESIBsfN0cQiIkACOOSheJkADseDlgRiIkQyKk5g1hhELaHheli0RIBolw046q3tRSHWkIfRvVa29cPMOMREgGztDAgPpl01b/ZFQaJWKJ4ICyxMVeF4mQOiyJkNooH7AhLkpXC4mQDImQie6OqNvnwS7Xzrgr3ZmwSSKkGHA96WCJwoNyxl3pIhEydyKkGBBah8Lp4B6wLy5KF4mQjImQqFtQcVG6SIRkSYQUA8IPSJxA3QIRcVK6SITMmwgpxwJbohn9RSKkzVngQUhCIiRAFi4eyVAgERKAHUelS0iEBGDG0QEzALDj4jIVABQKpQtgSShdAEtC6QJYEkoXwJJQugCWxNd9XcNESDySAZCNo/u6OR6EvPWm6+67eX6RlweAZ7wcMOdOhDx76es3PvlSN9DOiZAz6ziUAy5KlyUR8vTF8Q+/mCjO8nCZCEliYIeSCHlN7tse9ZglaYFNcHGuy5IIqYxm55NeT08qEdJBza1+OljapYFS42KvmzsR0nA0c+WfCKlEbfk8yKayNS5KVys7EbIQ5ZwIqdZzlSv+jHziZ6hce+OudGeivBMhHdQcTf/0PGt+jAA2wV3pIhEydyIkEVU4gy90Ng6+LOJ/XGJnXJQuEiEZEyEBVFyULhIh8yZCJim2uyk1SZJine0n8X8/sDkuSheJkHkTIR3U/Nw+SVn+SsFbJWJXbHfWeBASiZAAOlw8kqFAIiQAO45Kl5AICcCMowNmAGDHxWUqACgUShfAklC6AJaE0gWwJJQugCWhdAEsia/7ukiEBGDE0X1dJEICsOPlgBmJkAyJkCliQBDYxoQyxkXpIhGSXTzS1DrUOO3Xg6FscHGui0RIRpOJyM72Ncek+l+4Xin1skCJcbHXRSKkjkkiZCKy4+UHpZ77GNYClD0uSlcLiZBmiZBiwHV0Wy+CIEHBXenORBknQsqxQOsQS/wd2AUX57paSiLkN5c7p7HjHZHOVLi36RIhj0qJZDJ+ihqeMUmErHCH32NLhNzoCq0VZU0ipDau0f2g0WQFJEKmfztGpDNEJ1uEqPqvd/re7+6ITp6keiGkDjzlEiREbdgYF3tdJELmToT8R/De0MDU1wmpcwO5IxLq1ta4KF0kQuZNhATQ4aJ0kQiZNxESQMcaD0IiERJAh6PLVEiEBGDHUekSEiEBmHF0wAwA7Li4TAUAhULpAlgSShfAklC6AJaE0gWwJAuU7v4TgXNjo/nHA7ATvm4OGSZCHht6gIi8zoe3OB8p3aIB8IWj0jV7EPLsudTrdMtq67bf9vjy2rrscQDshpcD5tyJkIrzY6Ndp9rVr3ZLhNQE9Ag54njAJrh4EJIlEZKIls5f+aO1TxRheZrC0ptc5lFUuMPpd6HA7rgoXZZEyMULfeuXPbS8dkFpFhGAM1wcMOdOhKypXrFyycHFC322T4QEmMJF6WplJ0KuXHKwpnoF29TlnAhJRJODqbSAmZ3kQzngrnRnoowTIYmoPpjKp7om50/kgbLHXekqiZDjly9NY9oR6UyF26VLhBySEsmR+ClqqDdJhOx1s4SkOoO9ne+GQmvFHk0iZDpbx2WaTVVAIqSmF0Sp6BxB0IZOqv1q7unzy9EjyKyyMy5KF4mQuRMhDS93a3+kwIa4KF0kQjIkQibCTalfjSTFAt6o2+fBXSI746J0kQjJkAjpDPbWPysIgiBUCt44r3eeoWgs8CAkIRESIAsXj2QokAgJwI6j0iUkQgIw4+iAGQDYFXuve2Xrtmvv/KvIM4XpqWy8Y/5fXiz1UoCxYu91L6+oL+bsYIZu/CBe6kUAY6U518UfBP/wI8s5Lu7rAkChULoAlmSB0kUiJEA2vu7rGiZCnh8b7TgRQCIkgBZHpWv4IKRaxn2JF9+98E8kQgIoeDlgRiJk3kRIygy+wav2NsfFXheJkCyU9xbiYUnmb9mg+LgoXSRCsjge8P7JL15F3QIRcXLAjERInexEyCTFjkTdnSG8KAgpXJSuFhIhDRMhkwnp39TgHEn/DOQ7K4ayx13pzkR5J0ISRbcebU3/KiWDLv2xA9gKd6WLREjzRMipA2b1Vwlsi4vSRSJk3kRIh9P1nenOAsoSF6WLRMi8iZAOam7vTKpdyJ4K7IaL0kUiJEMiJNUHB9QuZE8FdlOaV+0N39dFIiRXcmwp4AEXj2QokAgJwI6j0iUkQgIwQzYV5IIDZm4V+zJVZeMdRZ4jTBs2Fs+QwwxgSVzcHAKAQv0fgqTHmFu3VaMAAAAASUVORK5CYII=" />
		</div>
		<div><br />
		</div>
		<div>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<pre style="background-color:#ffffff;color:#000000;font-family:'Consolas';font-size:13.5pt;">
<span style="color:#000080;font-weight:bold;">package </span>com.mmall.concurrency.example.lock;<br><br><span style="color:#000080;font-weight:bold;">import </span>lombok.extern.slf4j.<span style="color:#808000;">Slf4j</span>;<br><br><span style="color:#000080;font-weight:bold;">import </span>java.util.concurrent.locks.Condition;<br><span style="color:#000080;font-weight:bold;">import </span>java.util.concurrent.locks.ReentrantLock;<br><br><span style="color:#808000;">@Slf4j<br></span><span style="color:#000080;font-weight:bold;">public class </span>LockExample6 {<br><br>    <span style="color:#000080;font-weight:bold;">public static void </span>main(String[] args) {<br>        ReentrantLock reentrantLock = <span style="color:#000080;font-weight:bold;">new </span>ReentrantLock();<br>        Condition condition = reentrantLock.newCondition();<br><br>        <span style="color:#000080;font-weight:bold;">new </span>Thread(() -&gt; {<br>            <span style="color:#000080;font-weight:bold;">try </span>{<br>                <span style="color:#660e7a;">reentrantLock</span>.lock();<br>                <span style="color:#660e7a;font-weight:bold;font-style:italic;">log</span>.info(<span style="color:#008000;font-weight:bold;">"wait signal"</span>); <span style="color:#008000;font-weight:bold;">// 1<br></span><span style="color:#008000;font-weight:bold;">                </span><span style="color:#660e7a;">condition</span>.await();<br>            } <span style="color:#000080;font-weight:bold;">catch </span>(InterruptedException e) {<br>                e.printStackTrace();<br>            }<br>            log.info(<span style="color:#008000;font-weight:bold;">"get signal"</span>); <span style="color:#008000;font-weight:bold;">// 4<br></span><span style="color:#008000;font-weight:bold;">            </span>reentrantLock.unlock();<br>        }).start();<br><br>        <span style="color:#000080;font-weight:bold;">new </span>Thread(() -&gt; {<br>            reentrantLock.lock();<br>            log.info(<span style="color:#008000;font-weight:bold;">"get lock"</span>); <span style="color:#008000;font-weight:bold;">// 2<br></span><span style="color:#008000;font-weight:bold;">            </span><span style="color:#000080;font-weight:bold;">try </span>{<br>                Thread.sleep(<span style="color:#0000ff;">3000</span>);<br>            } <span style="color:#000080;font-weight:bold;">catch </span>(InterruptedException e) {<br>                e.printStackTrace();<br>            }<br>            condition.signalAll();<br>            log.info(<span style="color:#008000;font-weight:bold;">"send signal ~ "</span>); <span style="color:#008000;font-weight:bold;">// 3<br></span><span style="color:#008000;font-weight:bold;">            </span>reentrantLock.unlock();<br>        }).start();<br>    }<br>}<br></pre>
		</div>
		<div>
			<div>09:34:48.251 [Thread-0] INFO com.mmall.concurrency.example.lock.LockExample6 - wait signal
			</div>
			<div>09:34:48.257 [Thread-1] INFO com.mmall.concurrency.example.lock.LockExample6 - get lock
			</div>
			<div>09:34:51.257 [Thread-1] INFO com.mmall.concurrency.example.lock.LockExample6 - send signal ~ 
			</div>
			<div>09:34:51.257 [Thread-0] INFO com.mmall.concurrency.example.lock.LockExample6 - get signal
			</div>
		</div>
		<div><br />
		</div>
		<div><br />
		</div>
		<div><br />
		</div>
		<div><br />
		</div>
		<div><br />
		</div>
		<div><br />
		</div>
		<div><br />
		</div>
		<div><br />
		</div>
	
<script type="text/javascript" language="javascript" src="jquery.js"></script>
<script type="text/javascript" language="javascript" src="itemlink.js"></script></body>
</html>