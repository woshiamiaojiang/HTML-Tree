<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<style>
			table{border-collapse: collapse; border: 1px solid gray; border-width: 2px 1px 2px 1px;}
			th{border: 1px solid gray; padding: 4px; background-color: #ddd;}
			td{border: 1px solid gray; padding: 4px;}
			tr:nth-child(2n){background-color: #f8f8f8;}
			pre{border: 2px solid #d6d6d6; padding: 0px; border-radius: 3px;}
		</style>
	</head>
	<body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">
		<div><img src="data:image/png;base64,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" />
		</div>
		<div>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<pre style="background-color:#ffffff;color:#000000;font-family:'Consolas';font-size:13.5pt;">
<span style="color:#000080;font-weight:bold;">package </span>com.imooc.sell.enums;<br><br><span style="color:#000080;font-weight:bold;">import </span>lombok.<span style="color:#808000;">Getter</span>;<br><br><span style="color:#008000;font-weight:bold;">/**<br></span><span style="color:#008000;font-weight:bold;"> * Created by 80003415<br></span><span style="color:#008000;font-weight:bold;"> * 2018-08-18 9:49<br></span><span style="color:#008000;font-weight:bold;"> */<br></span><span style="color:#808000;">@Getter<br></span><span style="color:#000080;font-weight:bold;">public enum </span>ResultEnum <span style="background-color:#f6ebbc;">{<br></span><span style="background-color:#f6ebbc;"><br></span><span style="background-color:#f6ebbc;">    PRODUCT_NOT_EXIT(</span><span style="color:#0000ff;background-color:#f6ebbc;">10</span><span style="background-color:#f6ebbc;">, </span><span style="color:#008000;background-color:#f6ebbc;font-weight:bold;">"</span><span style="color:#008000;background-color:#f6ebbc;font-weight:bold;font-family:'宋体';">商品不存在</span><span style="color:#008000;background-color:#f6ebbc;font-weight:bold;">"</span><span style="background-color:#f6ebbc;">),<br></span><span style="background-color:#f6ebbc;"><br></span><span style="background-color:#f6ebbc;">    PRODUCT_STOCK_ERROR(</span><span style="color:#0000ff;background-color:#f6ebbc;">11</span><span style="background-color:#f6ebbc;">, </span><span style="color:#008000;background-color:#f6ebbc;font-weight:bold;">"</span><span style="color:#008000;background-color:#f6ebbc;font-weight:bold;font-family:'宋体';">商品库存不正确</span><span style="color:#008000;background-color:#f6ebbc;font-weight:bold;">"</span><span style="background-color:#f6ebbc;">),<br></span><span style="background-color:#f6ebbc;"><br></span><span style="background-color:#f6ebbc;">    ORDER_NOT_EXIST(</span><span style="color:#0000ff;background-color:#f6ebbc;">12</span><span style="background-color:#f6ebbc;">, </span><span style="color:#008000;background-color:#f6ebbc;font-weight:bold;">"</span><span style="color:#008000;background-color:#f6ebbc;font-weight:bold;font-family:'宋体';">订单不存在</span><span style="color:#008000;background-color:#f6ebbc;font-weight:bold;">"</span><span style="background-color:#f6ebbc;">),<br></span><span style="background-color:#f6ebbc;"><br></span><span style="background-color:#f6ebbc;">    ORDERDETAIL_NOT_EXIST(</span><span style="color:#0000ff;background-color:#f6ebbc;">13</span><span style="background-color:#f6ebbc;">, </span><span style="color:#008000;background-color:#f6ebbc;font-weight:bold;">"</span><span style="color:#008000;background-color:#f6ebbc;font-weight:bold;font-family:'宋体';">订单详情不存在</span><span style="color:#008000;background-color:#f6ebbc;font-weight:bold;">"</span><span style="background-color:#f6ebbc;">),<br></span><span style="background-color:#f6ebbc;">    ;<br></span><span style="background-color:#f6ebbc;"><br></span><span style="background-color:#f6ebbc;">    </span><span style="color:#000080;background-color:#f6ebbc;font-weight:bold;">private </span><span style="background-color:#f6ebbc;">Integer code;<br></span><span style="background-color:#f6ebbc;"><br></span><span style="background-color:#f6ebbc;">    </span><span style="color:#000080;background-color:#f6ebbc;font-weight:bold;">private </span><span style="background-color:#f6ebbc;">String message;<br></span><span style="background-color:#f6ebbc;"><br></span><span style="background-color:#f6ebbc;">    ResultEnum(Integer i, String message) {<br></span><span style="background-color:#f6ebbc;">        </span><span style="color:#000080;background-color:#f6ebbc;font-weight:bold;">this</span><span style="background-color:#f6ebbc;">.code = code;<br></span><span style="background-color:#f6ebbc;">        </span><span style="color:#000080;background-color:#f6ebbc;font-weight:bold;">this</span><span style="background-color:#f6ebbc;">.message = message;<br></span><span style="background-color:#f6ebbc;">    }<br></span><span style="background-color:#f6ebbc;">}</span><br></pre>
		</div>
		<div><br />
		</div>
		<div><img src="data:image/png;base64,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" />
		</div>
		<div>添加findOne
		</div>
		<div>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<pre style="background-color:#ffffff;color:#000000;font-family:'Consolas';font-size:13.5pt;">
<span style="color:#000080;font-weight:bold;">package </span>com.imooc.sell.service.impl;<br><br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dataobject.OrderDetail;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dataobject.OrderMaster;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dataobject.ProductInfo;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dto.CartDTO;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dto.OrderDTO;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.enums.OrderStatusEnum;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.enums.PayStatusEnum;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.enums.ResultEnum;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.exception.SellException;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.repository.OrderDetailRepository;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.repository.OrderMasterRepository;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.service.OrderService;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.service.ProductService;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.utils.KeyUtil;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.beans.BeanUtils;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.beans.factory.annotation.<span style="color:#808000;">Autowired</span>;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.data.domain.Page;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.data.domain.Pageable;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.stereotype.<span style="color:#808000;">Service</span>;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.transaction.annotation.<span style="color:#808000;">Transactional</span>;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.util.CollectionUtils;<br><br><span style="color:#000080;font-weight:bold;">import </span>java.math.BigDecimal;<br><span style="color:#000080;font-weight:bold;">import </span>java.math.BigInteger;<br><span style="color:#000080;font-weight:bold;">import </span>java.util.List;<br><span style="color:#000080;font-weight:bold;">import </span>java.util.stream.Collectors;<br><br><span style="color:#008000;font-weight:bold;">/**<br></span><span style="color:#008000;font-weight:bold;"> * Created by 80003415<br></span><span style="color:#008000;font-weight:bold;"> * 2018-08-18 9:27<br></span><span style="color:#008000;font-weight:bold;"> */<br></span><span style="color:#808000;">@Service<br></span><span style="color:#000080;font-weight:bold;">public class </span>OrderServiceImpl <span style="color:#000080;font-weight:bold;">implements </span>OrderService {<br><br>    <span style="color:#808000;">@Autowired<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">private </span>ProductService <span style="color:#660e7a;font-weight:bold;">productService</span>;<br><br>    <span style="color:#808000;">@Autowired<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">private </span>OrderDetailRepository <span style="color:#660e7a;font-weight:bold;">orderDetailRepository</span>;<br><br>    <span style="color:#808000;">@Autowired<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">private </span>OrderMasterRepository <span style="color:#660e7a;font-weight:bold;">orderMasterRepository</span>;<br><br>    <span style="color:#808000;">@Override<br></span><span style="color:#808000;">    @Transactional </span><span style="color:#008000;font-weight:bold;">// </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">如果错误，事务回滚，不进行任何错误<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">    </span><span style="color:#000080;font-weight:bold;">public </span>OrderDTO create(OrderDTO orderDTO) {<br><br>        String orderId = KeyUtil.<span style="font-style:italic;">genUniqueKey</span>();<br><br>        BigDecimal orderAmount = <span style="color:#000080;font-weight:bold;">new </span>BigDecimal(BigInteger.<span style="color:#660e7a;font-weight:bold;font-style:italic;">ZERO</span>);<br><br><span style="color:#008000;font-weight:bold;">//        List&lt;CartDTO&gt; cartDTOList = new ArrayList&lt;&gt;();<br></span><span style="color:#008000;font-weight:bold;"><br></span><span style="color:#008000;font-weight:bold;">        //1. </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">查询商品</span><span style="color:#008000;font-weight:bold;"> (</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">数量</span><span style="color:#008000;font-weight:bold;">, </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">价格</span><span style="color:#008000;font-weight:bold;">)<br></span><span style="color:#008000;font-weight:bold;">        </span><span style="color:#000080;font-weight:bold;">for </span>(OrderDetail orderDetail : orderDTO.getOrderDetailList()) {<br>            ProductInfo productInfo = <span style="color:#660e7a;font-weight:bold;">productService</span>.findOne(orderDetail.getProductId());<br>            <span style="color:#000080;font-weight:bold;">if </span>(productInfo == <span style="color:#000080;font-weight:bold;">null</span>) {<br>                <span style="color:#000080;font-weight:bold;">throw new </span>SellException(ResultEnum.<span style="color:#660e7a;font-weight:bold;font-style:italic;">PRODUCT_NOT_EXIT</span>);<br>            }<br><br>            <span style="color:#008000;font-weight:bold;">//2. </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">计算订单总价<br></span><span style="color:#008000;font-weight:bold;">//            orderAmount = orderDetail.getProductPrice()<br></span><span style="color:#008000;font-weight:bold;">            </span>orderAmount = productInfo.getProductPrice()<br>                    .multiply(<span style="color:#000080;font-weight:bold;">new </span>BigDecimal(orderDetail.getProductQuantity()))<br>                    .add(orderAmount);<br><br>            <span style="color:#008000;font-weight:bold;">//3. </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">订单详情入库</span><span style="color:#008000;font-weight:bold;"> (orderDetail)<br></span><span style="color:#008000;font-weight:bold;">            </span>orderDetail.setDetailId(KeyUtil.<span style="font-style:italic;">genUniqueKey</span>());<br>            orderDetail.setOrderId(orderId);<br>            <span style="color:#008000;font-weight:bold;">// orderDetail.setProductName(productInfo.getProductName());<br></span><span style="color:#008000;font-weight:bold;">            // Spring</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">的方法。进行对象的属性拷贝<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">            </span>BeanUtils.<span style="font-style:italic;">copyProperties</span>(productInfo, orderDetail);<br>            <span style="color:#660e7a;font-weight:bold;">orderDetailRepository</span>.save(orderDetail);<br><br><span style="color:#008000;font-weight:bold;">//            CartDTO cartDTO = new CartDTO(orderDetail.getProductId(), orderDetail.getProductQuantity());<br></span><span style="color:#008000;font-weight:bold;">//            cartDTOList.add(cartDTO);<br></span><span style="color:#008000;font-weight:bold;">        </span>}<br><br>        <span style="color:#008000;font-weight:bold;">//3. </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">写入订单数据库</span><span style="color:#008000;font-weight:bold;"> (orderMaster)<br></span><span style="color:#008000;font-weight:bold;">        </span>OrderMaster orderMaster = <span style="color:#000080;font-weight:bold;">new </span>OrderMaster();<br>        <span style="color:#008000;font-weight:bold;">// </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">调整</span><span style="color:#008000;font-weight:bold;">BeanUtils.copyProperties</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">顺序。防止</span><span style="color:#008000;font-weight:bold;">NPE</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">。<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">        </span>BeanUtils.<span style="font-style:italic;">copyProperties</span>(orderDTO, orderMaster);<br>        orderMaster.setOrderId(orderId);<br>        orderMaster.setOrderAmount(orderAmount);<br>        <span style="color:#008000;font-weight:bold;">// </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">重新复制。前面拷贝两个状态属性被设为</span><span style="color:#008000;font-weight:bold;">null</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">。<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">        </span>orderMaster.setOrderStatus(OrderStatusEnum.<span style="color:#660e7a;font-weight:bold;font-style:italic;">NEW</span>.getCode());<br>        orderMaster.setPayStatus(PayStatusEnum.<span style="color:#660e7a;font-weight:bold;font-style:italic;">WAIT</span>.getCode());<br>        <span style="color:#660e7a;font-weight:bold;">orderMasterRepository</span>.save(orderMaster);<br><br>        <span style="color:#008000;font-weight:bold;">//4. </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">扣库存<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">        </span>List&lt;CartDTO&gt; cartDTOList = orderDTO.getOrderDetailList().stream().map(e -&gt;<br>                <span style="color:#000080;font-weight:bold;">new </span>CartDTO(e.getProductId(), e.getProductQuantity())<br>        ).collect(Collectors.<span style="font-style:italic;">toList</span>());<br>        <span style="color:#660e7a;font-weight:bold;">productService</span>.decreaseStock(cartDTOList);<br><br>        <span style="color:#000080;font-weight:bold;">return </span>orderDTO;<br>    }<br><br>    <span style="color:#808000;">@Override<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public </span>OrderDTO findOne(String orderId) {<br>        OrderMaster orderMaster = <span style="color:#660e7a;font-weight:bold;">orderMasterRepository</span>.findOne(orderId);<br>        <span style="color:#000080;font-weight:bold;">if </span>(orderMaster == <span style="color:#000080;font-weight:bold;">null</span>) {<br>            <span style="color:#000080;font-weight:bold;">throw new </span>SellException(ResultEnum.<span style="color:#660e7a;font-weight:bold;font-style:italic;">ORDER_NOT_EXIST</span>);<br>        }<br><br>        List&lt;OrderDetail&gt; orderDetailList = <span style="color:#660e7a;font-weight:bold;">orderDetailRepository</span>.findByOrderId(orderId);<br>        <span style="color:#000080;font-weight:bold;">if </span>(CollectionUtils.<span style="font-style:italic;">isEmpty</span>(orderDetailList)) {<br>            <span style="color:#000080;font-weight:bold;">throw new </span>SellException(ResultEnum.<span style="color:#660e7a;font-weight:bold;font-style:italic;">ORDERDETAIL_NOT_EXIST</span>);<br>        }<br><br>        OrderDTO orderDTO = <span style="color:#000080;font-weight:bold;">new </span>OrderDTO();<br>        BeanUtils.<span style="font-style:italic;">copyProperties</span>(orderMaster, orderDTO);<br>        orderDTO.setOrderDetailList(orderDetailList);<br><br>        <span style="color:#000080;font-weight:bold;">return </span>orderDTO;<br>    }<br><br>    <span style="color:#808000;">@Override<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public </span>Page&lt;OrderDTO&gt; findList(String buyerOpenid, Pageable pageable) {<br>        <span style="color:#000080;font-weight:bold;">return null</span>;<br>    }<br><br>    <span style="color:#808000;">@Override<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public </span>OrderDTO cancel(OrderDTO orderDTO) {<br>        <span style="color:#000080;font-weight:bold;">return null</span>;<br>    }<br><br>    <span style="color:#808000;">@Override<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public </span>OrderDTO finish(OrderDTO orderDTO) {<br>        <span style="color:#000080;font-weight:bold;">return null</span>;<br>    }<br><br>    <span style="color:#808000;">@Override<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public </span>OrderDTO paid(OrderDTO orderDTO) {<br>        <span style="color:#000080;font-weight:bold;">return null</span>;<br>    }<br>}<br></pre>
		</div>
		<div><img src="data:image/png;base64,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" />
		</div>
		<div>测试findOne
		</div>
		<div>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<pre style="background-color:#ffffff;color:#000000;font-family:'Consolas';font-size:13.5pt;">
<span style="color:#000080;font-weight:bold;">package </span>com.imooc.sell.service.impl;<br><br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dataobject.OrderDetail;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dataobject.OrderMaster;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dto.OrderDTO;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.enums.ResultEnum;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.exception.SellException;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.repository.OrderDetailRepository;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.repository.OrderMasterRepository;<br><span style="color:#000080;font-weight:bold;">import </span>lombok.extern.slf4j.<span style="color:#808000;">Slf4j</span>;<br><span style="color:#000080;font-weight:bold;">import </span>org.junit.Assert;<br><span style="color:#000080;font-weight:bold;">import </span>org.junit.<span style="color:#808000;">Test</span>;<br><span style="color:#000080;font-weight:bold;">import </span>org.junit.runner.<span style="color:#808000;">RunWith</span>;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.beans.BeanUtils;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.beans.factory.annotation.<span style="color:#808000;">Autowired</span>;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.boot.test.context.<span style="color:#808000;">SpringBootTest</span>;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.data.domain.Pageable;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.test.context.junit4.SpringRunner;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.util.CollectionUtils;<br><br><span style="color:#000080;font-weight:bold;">import </span>java.util.ArrayList;<br><span style="color:#000080;font-weight:bold;">import </span>java.util.List;<br><br><span style="color:#000080;font-weight:bold;">import static </span>org.junit.Assert.*;<br><br><span style="color:#008000;font-weight:bold;">/**<br></span><span style="color:#008000;font-weight:bold;"> * Created by 80003415<br></span><span style="color:#008000;font-weight:bold;"> * 2018-08-18 22:35<br></span><span style="color:#008000;font-weight:bold;"> */<br></span><span style="color:#808000;">@RunWith</span>(SpringRunner.<span style="color:#000080;font-weight:bold;">class</span>)<br><span style="color:#808000;">@SpringBootTest<br></span><span style="color:#808000;">@Slf4j<br></span><span style="color:#000080;font-weight:bold;">public class </span>OrderServiceImplTest {<br><br>    <span style="color:#808000;">@Autowired<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">private </span>OrderServiceImpl <span style="color:#660e7a;font-weight:bold;">orderService</span>;<br><br>    <span style="color:#000080;font-weight:bold;">private final </span>String <span style="color:#660e7a;font-weight:bold;">BUYER_OPENID </span>= <span style="color:#008000;font-weight:bold;">"1101110"</span>;<br><br>    <span style="color:#000080;font-weight:bold;">private final </span>String <span style="color:#660e7a;font-weight:bold;">ORDER_ID </span>= <span style="color:#008000;font-weight:bold;">"1534607627214694549"</span>;<br><br>    <span style="color:#808000;">@Test<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public void </span>create() {<br><br>        OrderDTO orderDTO = <span style="color:#000080;font-weight:bold;">new </span>OrderDTO();;<br>        orderDTO.setBuyerName(<span style="color:#008000;font-weight:bold;">"</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">廖师兄</span><span style="color:#008000;font-weight:bold;">"</span>);<br>        orderDTO.setBuyerAddress(<span style="color:#008000;font-weight:bold;">"</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">慕课网</span><span style="color:#008000;font-weight:bold;">"</span>);<br>        orderDTO.setBuyerPhone(<span style="color:#008000;font-weight:bold;">"123456789012"</span>);<br>        orderDTO.setBuyerOpenid(<span style="color:#660e7a;font-weight:bold;">BUYER_OPENID</span>);<br><br>        <span style="color:#008000;font-weight:bold;">// </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">购物车<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">        </span>List&lt;OrderDetail&gt; orderDetailList = <span style="color:#000080;font-weight:bold;">new </span>ArrayList&lt;&gt;();<br><br>        OrderDetail o1 = <span style="color:#000080;font-weight:bold;">new </span>OrderDetail();<br>        o1.setProductId(<span style="color:#008000;font-weight:bold;">"1234568"</span>);<br>        o1.setProductQuantity(<span style="color:#0000ff;">1</span>);<br><br>        OrderDetail o2 = <span style="color:#000080;font-weight:bold;">new </span>OrderDetail();<br>        o2.setProductId(<span style="color:#008000;font-weight:bold;">"123457"</span>);<br>        o2.setProductQuantity(<span style="color:#0000ff;">2</span>);<br><br>        orderDetailList.add(o1);<br>        orderDetailList.add(o2);<br><br>        orderDTO.setOrderDetailList(orderDetailList);<br><br>        OrderDTO result = <span style="color:#660e7a;font-weight:bold;">orderService</span>.create(orderDTO);<br>        <span style="color:#660e7a;font-weight:bold;font-style:italic;">log</span>.info(<span style="color:#008000;font-weight:bold;">"</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">【创建订单】</span><span style="color:#008000;font-weight:bold;"> result={}"</span>, result);<br>        Assert.<span style="font-style:italic;">assertNotNull</span>(result);<br>    }<br><br>    <span style="color:#808000;">@Test<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public void </span>findOne() {<br>        OrderDTO result = <span style="color:#660e7a;font-weight:bold;">orderService</span>.findOne(<span style="color:#660e7a;font-weight:bold;">ORDER_ID</span>);<br>        <span style="color:#660e7a;font-weight:bold;font-style:italic;">log</span>.info(<span style="color:#008000;font-weight:bold;">"</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">【查询单个订单】</span><span style="color:#008000;font-weight:bold;">result={}"</span>, result);<br>        Assert.<span style="font-style:italic;">assertEquals</span>(<span style="color:#660e7a;font-weight:bold;">ORDER_ID</span>, result.getOrderId());<br>    }<br><br>    <span style="color:#808000;">@Test<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public void </span>findList() {<br>    }<br><br>    <span style="color:#808000;">@Test<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public void </span>cancel() {<br>    }<br><br>    <span style="color:#808000;">@Test<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public void </span>finish() {<br>    }<br><br>    <span style="color:#808000;">@Test<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public void </span>paid() {<br>    }<br>}</pre>
		</div>
		<div>
			<div>
				<div>2018-08-19 09:23:43,203 - 【查询单个订单】result=OrderDTO(orderId=1534607627214694549, buyerName=廖师兄, buyerPhone=123456789012, buyerAddress=慕课网, buyerOpenid=1101110, orderAmount=26.40, orderStatus=0, payStatus=0, createTime=2018-08-18 15:53:51.0, updateTime=2018-08-18 15:53:51.0, orderDetailList=[OrderDetail(detailId=1534607627510922708, orderId=1534607627214694549, productId=1234568, productName=芒果冰, productPrice=20.00, productQuantity=1, productIcon=http://xxxx.jpg), OrderDetail(detailId=1534607627959660681, orderId=1534607627214694549, productId=123457, productName=皮皮虾, productPrice=3.20, productQuantity=2, productIcon=http://xxxxx.jpg)])
				</div>
			</div>
			<div><br />
			</div>
			<div><br />
			</div>
			<div><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASYAAAAqCAIAAACRE2FCAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAH+UlEQVR4nO2cT2zbVBjAP7ewAWJi4jYYMI3ZRJOKNDGBHIQYBxDxyhQOERekXpDNbSTptaeeQImNuEDNLpWQEIoEkWjjDQ6MgWppTNtEtRHsTdOAClHBoGK0a5rlcfCfPDu246S14zbvpxzc5++97/te3+f3/Od9FEIICARCXIwM2gACYbggIUcgxAoJOQIhVu6JotEvvvrWPn7gvt1PHXziwP59USjqgi6lmUpOW8jTA1DeDUWgqlk0k2kfEIaCyGe51Tvrl65qP9/4JWpFBMK2IJJZrpOr+o2r+o3O8tdfeTFCrXR+AeUjbH9HoUtppj5FZtvI8Z3l5ufny+Wyq7BcLs/Pz0dsEoGwk/ENuXq9rmkaHnXlclnTtHq9Hr710ZGRA/v3Hdi/b3QkzApWESiTtKS7SihKUNpiaUmR0napJWXVstCltFkrTBVPXaHKXXp1U4/LZm/hLegKCfdFl9JtFdgfnQ0avaMIFEWx/BsUU1BB5qhQ8uF8IHjiGwnFYpFhGDvqjHhjGKZYLIZv/ehY6shh5shh5uhYqpusIlDcoqghhBBCC3naVYJqwLWHmlqYhlmEUI2XOYqqZhFCSBOhUFJ82w+u4qcrVLnj+YwuTRTGamYFY5mmCNR0ypTVchVG8Leyn66o275MSDqdn+LVypwOAKDPVVR+Kk/7GyBz1SxCSJU/Q5rIAl8z9HWTT+YDqe0CCqRUKvE8f/LkSZ7nS6VSsLDN52fOGr+NZtMo2Wg27UL8165T44G1x5RniTUmHCf8jp01ulbx0xW23GU3AH7aKMCwVNq28TVXA/10hSayxrFViEt5GNDuHVdnhZMn9EmX9Z4x162trfU6vxn88ect42DZOtgcbOrQVjSzKV1dbcjMIITQLExgKzBnCG3FJBFgRibLq5U5XZ+rgDhpPg3p1YCtN5hg0v0Wq1gsnjhxoo94A4ALP/508Yp28Yr2w48/dRHNZHnVXhcqkqQbJRP2XYNSKkBuPMy/3nE7Ew4/XYHlDmttpbokKQBA5xc0kVXr11zCoAg+60q7hU13RWZShEqpVLGEQhrg7I0e5Am9EOolwfHjx/trvYXQzaXfw8lmZjQxzVAUAABfQzMA9AyqCRRDFQwBvoaiu9hmfHT5l7ustSOczqdKFMVZ4hmXsOlbF2M22RX0eA4KhbEaojsb9DOAHs+xBY6SWVFbyPdoMKEHKBTBTgL865Ngon0vRyAkj0hCjkAg+EE+ayYQYiWmD758ee45OH9+wDYQCP1x7Bh8802vlQa9sDRv0QmE7Unv4TPoWc6A3E8Sth39zhbkXo5AiBUScgRCrJCQIxBihYQcgRAryXh84sVaE126def6v41/1u8CwN7do0/u2XXk4fvuv4c85CRsYxI6y+krjVPa3+ry6vJas9FCjRZaXmuqy6untL/1lcZWalKEId1wObSOD5okhpy+0vjy19uNlsebg0YLffnrbe+owzZjR7Zv2dDR2Xgse6W9dpu7yiN23GN3PL5Z3X2yi2FY1WHaq5C4kFtttk4v3Ubg+6YOATq9dHu12XKUKgLFVHL2Hi8tV2Gi+j+yLJi7ri10aVruuZl2lohwKMIEzJreiYucVTVGx9v7U2vAWWFi7A50bLS1t8IHGKYIFMWB3WC2GteM22u3bz2JC7nLt9bt+Q2hlnZWOffhu+qp989/8pEt02ihy7fWsUqKwMl8DdtISecXarzMRdK3Y7mcM+ODPlcBUXTvpN5qMjO2f/R4jl2s6xCz47gtjrD3INgw4yyWTQxzbseTuJC7/m970aifPbOydPP5t95h33rn2Tff9hMDpSqz9v5ni0yWB2NcdubJwZY0HD4/dcmxoxlSqfwUL0+7NoziuV28VoB4WQ0UYVPpfa7V1bEUHbvjOPR4jpWrfjEXbJjn2Q5LdmpWpcSFnPF80uC3y+cPvvDy6L27g8V8OJQyNmUDgCNPjiJgSxoszUf3HDuMJYptm9alaZmfcuYbKlkrQPu67sxBxBnTRL/pfRSBW/QbsRE7vjkchnkxFFmVEhdyTtDmPr9sJwjha9YqxnmJzWStoadUZVALjHHJYwqqOVM46tpkJkVWnpZ0UEoFcA1/Oj+TB2NOs2cSOjUGMud32exFtRE33QZDZI77aAlNYBWlKrPirO1aZlJsT6SW6fR4jrUcMGJOn6uofDbTuyP9O74pEhdye3eP2sePPP3MtXNf391YDxZz5eowUUoFY/UVnh5y7JhXWakqs64sJLqUpijzSYcmspaJHjmIeldtzlMzWNzE7TimJSD/SrBhdrSEsGznZVVKXMg9uWeXfcy8xO195PHv5fJ3H7134dOP/cTM6yGHDWVdSnOy97XKMRqwZ4195eQpuBaVAHCtrlqXan2uolp63DmIfE3yU61LaWo6pTkzmA/CcbAWgLMBIzTYsMykCAXGkbY3PTxZldBgAUBOG/7buPvBlb9Ki38G/D648td/G3fdTbWnFHBevjoSMLbvY1hRdGaCtE5Y8v7JHl1/tDNKtlthed4jNyTetG1pV9Xu3JKYg3E57q2k3XRHkktfwzo88vbTo3OxdJ2WAlxtd0d67PYAOoZuSJKxRdVpg/Eq3O/VHAXUa489SD+0y/MsgRATXkM3VL0EhhwA6CuN00seH6DsGqFefZTEGyEB7LCQA/JZMyHh7LyQIxASTb9DNxmbd0jSIcLQMOiXBMeODdgAAqFv+hq9g15YEghDxv8drbcxIAy9pQAAAABJRU5ErkJggg==" />
			</div>
			<div>findList
			</div>
			<div>
				<meta http-equiv="content-type" content="text/html; charset=utf-8" />
				<pre style="background-color:#ffffff;color:#000000;font-family:'Consolas';font-size:13.5pt;">
<span style="color:#000080;font-weight:bold;">package </span>com.imooc.sell.converter;<br><br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dataobject.OrderMaster;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dto.OrderDTO;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.beans.BeanUtils;<br><br><span style="color:#000080;font-weight:bold;">import </span>java.util.List;<br><span style="color:#000080;font-weight:bold;">import </span>java.util.stream.Collectors;<br><br><span style="color:#008000;font-weight:bold;">/**<br></span><span style="color:#008000;font-weight:bold;"> * Created by 80003415<br></span><span style="color:#008000;font-weight:bold;"> * 2018-08-19 9:37<br></span><span style="color:#008000;font-weight:bold;"> */<br></span><span style="color:#000080;font-weight:bold;">public class </span>OrderMaster2OrderDTOConverter {<br><br>    <span style="color:#000080;font-weight:bold;">public static </span>OrderDTO convert(OrderMaster orderMaster) {<br><br>        OrderDTO orderDTO = <span style="color:#000080;font-weight:bold;">new </span>OrderDTO();<br>        BeanUtils.<span style="font-style:italic;">copyProperties</span>(orderMaster, orderDTO);<br>        <span style="color:#000080;font-weight:bold;">return </span>orderDTO;<br>    }<br><br>    <span style="color:#000080;font-weight:bold;">public static </span>List&lt;OrderDTO&gt; convert(List&lt;OrderMaster&gt; orderMasterList) {<br>        <span style="color:#000080;font-weight:bold;">return </span>orderMasterList.stream().map(e -&gt;<br>                <span style="font-style:italic;">convert</span>(e)<br>        ).collect(Collectors.<span style="font-style:italic;">toList</span>());<br>    }<br>}</pre>
			</div>
			<div><img src="data:image/png;base64,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" />
			</div>
		</div>
		<div>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<pre style="color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.5pt; ">
<span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><span style="color:#000080;font-weight:bold;">package </span>com.imooc.sell.service.impl;<br><br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.converter.OrderMaster2OrderDTOConverter;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dataobject.OrderDetail;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dataobject.OrderMaster;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dataobject.ProductInfo;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dto.CartDTO;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.dto.OrderDTO;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.enums.OrderStatusEnum;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.enums.PayStatusEnum;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.enums.ResultEnum;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.exception.SellException;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.repository.OrderDetailRepository;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.repository.OrderMasterRepository;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.service.OrderService;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.service.ProductService;<br><span style="color:#000080;font-weight:bold;">import </span>com.imooc.sell.utils.KeyUtil;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.beans.BeanUtils;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.beans.factory.annotation.<span style="color:#808000;">Autowired</span>;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.data.domain.Page;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.data.domain.PageImpl;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.data.domain.Pageable;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.stereotype.<span style="color:#808000;">Service</span>;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.transaction.annotation.<span style="color:#808000;">Transactional</span>;<br><span style="color:#000080;font-weight:bold;">import </span>org.springframework.util.CollectionUtils;<br><br><span style="color:#000080;font-weight:bold;">import </span>java.math.BigDecimal;<br><span style="color:#000080;font-weight:bold;">import </span>java.math.BigInteger;<br><span style="color:#000080;font-weight:bold;">import </span>java.util.List;<br><span style="color:#000080;font-weight:bold;">import </span>java.util.stream.Collectors;<br><br><span style="color:#008000;font-weight:bold;">/**<br></span><span style="color:#008000;font-weight:bold;"> * Created by 80003415<br></span><span style="color:#008000;font-weight:bold;"> * 2018-08-18 9:27<br></span><span style="color:#008000;font-weight:bold;"> */<br></span><span style="color:#808000;">@Service<br></span><span style="color:#000080;font-weight:bold;">public class </span>OrderServiceImpl <span style="color:#000080;font-weight:bold;">implements </span>OrderService {<br><br>    <span style="color:#808000;">@Autowired<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">private </span>ProductService <span style="color:#660e7a;font-weight:bold;">productService</span>;<br><br>    <span style="color:#808000;">@Autowired<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">private </span>OrderDetailRepository <span style="color:#660e7a;font-weight:bold;">orderDetailRepository</span>;<br><br>    <span style="color:#808000;">@Autowired<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">private </span>OrderMasterRepository <span style="color:#660e7a;font-weight:bold;">orderMasterRepository</span>;<br><br>    <span style="color:#808000;">@Override<br></span><span style="color:#808000;">    @Transactional </span><span style="color:#008000;font-weight:bold;">// </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">如果错误，事务回滚，不进行任何错误<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">    </span><span style="color:#000080;font-weight:bold;">public </span>OrderDTO create(OrderDTO orderDTO) {<br><br>        String orderId = KeyUtil.<span style="font-style:italic;">genUniqueKey</span>();<br><br>        BigDecimal orderAmount = <span style="color:#000080;font-weight:bold;">new </span>BigDecimal(BigInteger.<span style="color:#660e7a;font-weight:bold;font-style:italic;">ZERO</span>);<br><br><span style="color:#008000;font-weight:bold;">//        List&lt;CartDTO&gt; cartDTOList = new ArrayList&lt;&gt;();<br></span><span style="color:#008000;font-weight:bold;"><br></span><span style="color:#008000;font-weight:bold;">        //1. </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">查询商品</span><span style="color:#008000;font-weight:bold;"> (</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">数量</span><span style="color:#008000;font-weight:bold;">, </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">价格</span><span style="color:#008000;font-weight:bold;">)<br></span><span style="color:#008000;font-weight:bold;">        </span><span style="color:#000080;font-weight:bold;">for </span>(OrderDetail orderDetail : orderDTO.getOrderDetailList()) {<br>            ProductInfo productInfo = <span style="color:#660e7a;font-weight:bold;">productService</span>.findOne(orderDetail.getProductId());<br>            <span style="color:#000080;font-weight:bold;">if </span>(productInfo == <span style="color:#000080;font-weight:bold;">null</span>) {<br>                <span style="color:#000080;font-weight:bold;">throw new </span>SellException(ResultEnum.<span style="color:#660e7a;font-weight:bold;font-style:italic;">PRODUCT_NOT_EXIT</span>);<br>            }<br><br>            <span style="color:#008000;font-weight:bold;">//2. </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">计算订单总价<br></span><span style="color:#008000;font-weight:bold;">//            orderAmount = orderDetail.getProductPrice()<br></span><span style="color:#008000;font-weight:bold;">            </span>orderAmount = productInfo.getProductPrice()<br>                    .multiply(<span style="color:#000080;font-weight:bold;">new </span>BigDecimal(orderDetail.getProductQuantity()))<br>                    .add(orderAmount);<br><br>            <span style="color:#008000;font-weight:bold;">//3. </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">订单详情入库</span><span style="color:#008000;font-weight:bold;"> (orderDetail)<br></span><span style="color:#008000;font-weight:bold;">            </span>orderDetail.setDetailId(KeyUtil.<span style="font-style:italic;">genUniqueKey</span>());<br>            orderDetail.setOrderId(orderId);<br>            <span style="color:#008000;font-weight:bold;">// orderDetail.setProductName(productInfo.getProductName());<br></span><span style="color:#008000;font-weight:bold;">            // Spring</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">的方法。进行对象的属性拷贝<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">            </span>BeanUtils.<span style="font-style:italic;">copyProperties</span>(productInfo, orderDetail);<br>            <span style="color:#660e7a;font-weight:bold;">orderDetailRepository</span>.save(orderDetail);<br><br><span style="color:#008000;font-weight:bold;">//            CartDTO cartDTO = new CartDTO(orderDetail.getProductId(), orderDetail.getProductQuantity());<br></span><span style="color:#008000;font-weight:bold;">//            cartDTOList.add(cartDTO);<br></span><span style="color:#008000;font-weight:bold;">        </span>}<br><br>        <span style="color:#008000;font-weight:bold;">//3. </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">写入订单数据库</span><span style="color:#008000;font-weight:bold;"> (orderMaster)<br></span><span style="color:#008000;font-weight:bold;">        </span>OrderMaster orderMaster = <span style="color:#000080;font-weight:bold;">new </span>OrderMaster();<br>        <span style="color:#008000;font-weight:bold;">// </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">调整</span><span style="color:#008000;font-weight:bold;">BeanUtils.copyProperties</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">顺序。防止</span><span style="color:#008000;font-weight:bold;">NPE</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">。<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">        </span>BeanUtils.<span style="font-style:italic;">copyProperties</span>(orderDTO, orderMaster);<br>        orderMaster.setOrderId(orderId);<br>        orderMaster.setOrderAmount(orderAmount);<br>        <span style="color:#008000;font-weight:bold;">// </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">重新复制。前面拷贝两个状态属性被设为</span><span style="color:#008000;font-weight:bold;">null</span><span style="color:#008000;font-weight:bold;font-family:'宋体';">。<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">        </span>orderMaster.setOrderStatus(OrderStatusEnum.<span style="color:#660e7a;font-weight:bold;font-style:italic;">NEW</span>.getCode());<br>        orderMaster.setPayStatus(PayStatusEnum.<span style="color:#660e7a;font-weight:bold;font-style:italic;">WAIT</span>.getCode());<br>        <span style="color:#660e7a;font-weight:bold;">orderMasterRepository</span>.save(orderMaster);<br><br>        <span style="color:#008000;font-weight:bold;">//4. </span><span style="color:#008000;font-weight:bold;font-family:'宋体';">扣库存<br></span><span style="color:#008000;font-weight:bold;font-family:'宋体';">        </span>List&lt;CartDTO&gt; cartDTOList = orderDTO.getOrderDetailList().stream().map(e -&gt;<br>                <span style="color:#000080;font-weight:bold;">new </span>CartDTO(e.getProductId(), e.getProductQuantity())<br>        ).collect(Collectors.<span style="font-style:italic;">toList</span>());<br>        <span style="color:#660e7a;font-weight:bold;">productService</span>.decreaseStock(cartDTOList);<br><br>        <span style="color:#000080;font-weight:bold;">return </span>orderDTO;<br>    }<br><br>    <span style="color:#808000;">@Override<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public </span>OrderDTO findOne(String orderId) {<br>        OrderMaster orderMaster = <span style="color:#660e7a;font-weight:bold;">orderMasterRepository</span>.findOne(orderId);<br>        <span style="color:#000080;font-weight:bold;">if </span>(orderMaster == <span style="color:#000080;font-weight:bold;">null</span>) {<br>            <span style="color:#000080;font-weight:bold;">throw new </span>SellException(ResultEnum.<span style="color:#660e7a;font-weight:bold;font-style:italic;">ORDER_NOT_EXIST</span>);<br>        }<br><br>        List&lt;OrderDetail&gt; orderDetailList = <span style="color:#660e7a;font-weight:bold;">orderDetailRepository</span>.findByOrderId(orderId);<br>        <span style="color:#000080;font-weight:bold;">if </span>(CollectionUtils.<span style="font-style:italic;">isEmpty</span>(orderDetailList)) {<br>            <span style="color:#000080;font-weight:bold;">throw new </span>SellException(ResultEnum.<span style="color:#660e7a;font-weight:bold;font-style:italic;">ORDERDETAIL_NOT_EXIST</span>);<br>        }<br><br>        OrderDTO orderDTO = <span style="color:#000080;font-weight:bold;">new </span>OrderDTO();<br>        BeanUtils.<span style="font-style:italic;">copyProperties</span>(orderMaster, orderDTO);<br>        orderDTO.setOrderDetailList(orderDetailList);<br><br>        <span style="color:#000080;font-weight:bold;">return </span>orderDTO;<br>    }<br><br>    <span style="color:#808000;">@Override<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public </span>Page&lt;OrderDTO&gt; </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 0);">findList</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(String buyerOpenid, Pageable pageable) {<br>        Page&lt;OrderMaster&gt; orderMasterPage = </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-weight: bold; ">orderMasterRepository</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">.findByBuyerOpenid(buyerOpenid, pageable);<br><br>        List&lt;OrderDTO&gt; orderDTOList = OrderMaster2OrderDTOConverter.</span><span style="background-color: rgb(255, 255, 255); font-style: italic; ">convert</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(orderMasterPage.getContent());<br><br>        </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">return new </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">PageImpl&lt;OrderDTO&gt;(orderDTOList, pageable, orderMasterPage.getTotalElements());<br>    }<br><br>    </span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">@Override<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">public </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">OrderDTO cancel(OrderDTO orderDTO) {<br>        </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">return null</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">;<br>    }<br><br>    </span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">@Override<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">public </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">OrderDTO finish(OrderDTO orderDTO) {<br>        </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">return null</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">;<br>    }<br><br>    </span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">@Override<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">public </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">OrderDTO paid(OrderDTO orderDTO) {<br>        </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">return null</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">;<br>    }<br>}<br></span></pre>
		</div>
		<div><img src="data:image/png;base64,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" />
		</div>
		<div>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<pre style="color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.5pt; ">
<span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">package </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">com.imooc.sell.service.impl;<br><br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">com.imooc.sell.dataobject.OrderDetail;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">com.imooc.sell.dataobject.OrderMaster;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">com.imooc.sell.dto.OrderDTO;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">com.imooc.sell.enums.ResultEnum;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">com.imooc.sell.exception.SellException;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">com.imooc.sell.repository.OrderDetailRepository;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">com.imooc.sell.repository.OrderMasterRepository;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">lombok.extern.slf4j.</span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">Slf4j</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">org.junit.Assert;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">org.junit.</span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">Test</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">org.junit.runner.</span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">RunWith</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">org.springframework.beans.BeanUtils;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">org.springframework.beans.factory.annotation.</span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">Autowired</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">org.springframework.boot.test.context.</span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">SpringBootTest</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">org.springframework.data.domain.Page;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">org.springframework.data.domain.PageRequest;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">org.springframework.data.domain.Pageable;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">org.springframework.test.context.junit4.SpringRunner;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">org.springframework.util.CollectionUtils;<br><br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">java.util.ArrayList;<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">java.util.List;<br><br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">import static </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">org.junit.Assert.*;<br><br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">/**<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; "> * Created by 80003415<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; "> * 2018-08-18 22:35<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; "> */<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">@RunWith</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(SpringRunner.</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">class</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">)<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">@SpringBootTest<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">@Slf4j<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">public class </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">OrderServiceImplTest {<br><br>    </span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">@Autowired<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">private </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">OrderServiceImpl </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-weight: bold; ">orderService</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">;<br><br>    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">private final </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">String </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-weight: bold; ">BUYER_OPENID </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">= </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">"1101110"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">;<br><br>    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">private final </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">String </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-weight: bold; ">ORDER_ID </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">= </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">"1534607627214694549"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">;<br><br>    </span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">@Test<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">public void </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">create() {<br><br>        OrderDTO orderDTO = </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">new </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">OrderDTO();;<br>        orderDTO.setBuyerName(</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">"</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; font-family: 宋体; ">廖师兄</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">);<br>        orderDTO.setBuyerAddress(</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">"</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; font-family: 宋体; ">慕课网</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">);<br>        orderDTO.setBuyerPhone(</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">"123456789012"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">);<br>        orderDTO.setBuyerOpenid(</span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-weight: bold; ">BUYER_OPENID</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">);<br><br>        </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">// </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; font-family: 宋体; ">购物车<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; font-family: 宋体; ">        </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">List&lt;OrderDetail&gt; orderDetailList = </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">new </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">ArrayList&lt;&gt;();<br><br>        OrderDetail o1 = </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">new </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">OrderDetail();<br>        o1.setProductId(</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">"1234568"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">);<br>        o1.setProductQuantity(</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); ">1</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">);<br><br>        OrderDetail o2 = </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">new </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">OrderDetail();<br>        o2.setProductId(</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">"123457"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">);<br>        o2.setProductQuantity(</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); ">2</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">);<br><br>        orderDetailList.add(o1);<br>        orderDetailList.add(o2);<br><br>        orderDTO.setOrderDetailList(orderDetailList);<br><br>        OrderDTO result = </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-weight: bold; ">orderService</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">.create(orderDTO);<br>        </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-weight: bold; font-style: italic; ">log</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">.info(</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">"</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; font-family: 宋体; ">【创建订单】</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; "> result={}"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, result);<br>        Assert.</span><span style="background-color: rgb(255, 255, 255); font-style: italic; ">assertNotNull</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(result);<br>    }<br><br>    </span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">@Test<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">public void </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">findOne() {<br>        OrderDTO result = </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-weight: bold; ">orderService</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">.findOne(</span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-weight: bold; ">ORDER_ID</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">);<br>        </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-weight: bold; font-style: italic; ">log</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">.info(</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">"</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; font-family: 宋体; ">【查询单个订单】</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-weight: bold; ">result={}"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, result);<br>        Assert.</span><span style="background-color: rgb(255, 255, 255); font-style: italic; ">assertEquals</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(</span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-weight: bold; ">ORDER_ID</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, result.getOrderId());<br>    }<br><br>    </span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">@Test<br></span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0); ">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold; ">public void </span><span class="Apple-style-span" style="background-color: rgb(255, 255, 0);">findList</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">() {<br>        PageRequest request = <span style="color:#000080;font-weight:bold;">new </span>PageRequest(<span style="color:#0000ff;">0</span>, <span style="color:#0000ff;">2</span>);<br>        Page&lt;OrderDTO&gt; orderDTOPage = <span style="color:#660e7a;font-weight:bold;">orderService</span>.findList(<span style="color:#660e7a;font-weight:bold;">BUYER_OPENID</span>, request);<br>        Assert.<span style="font-style:italic;">assertNotEquals</span>(<span style="color:#0000ff;">0</span>, orderDTOPage.getTotalElements());<br>    }<br><br>    <span style="color:#808000;">@Test<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public void </span>cancel() {<br>    }<br><br>    <span style="color:#808000;">@Test<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public void </span>finish() {<br>    }<br><br>    <span style="color:#808000;">@Test<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public void </span>paid() {<br>    }<br>}</span></pre>
		</div>
		<div><br />
		</div>
		<div><br />
		</div>
		<div><br />
		</div>
		<div><br />
		</div>
		<div><br />
		</div>
		<div><br />
		</div>
	
<script type="text/javascript" language="javascript" src="jquery.js"></script>
<script type="text/javascript" language="javascript" src="itemlink.js"></script></body>
</html>